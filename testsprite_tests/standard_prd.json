{
  "meta": {
    "project": "Logistics Platform",
    "date": "2025-11-19",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "The Logistics Platform is a comprehensive multi-user system designed to streamline last-mile delivery services in Kenya through a customer-facing web panel, an admin management interface, and a mobile driver app, integrating real-time tracking, flexible pricing models, and seamless payment options.",
  "core_goals": [
    "Enable customers to create and track delivery orders with flexible pricing options.",
    "Provide admins with an efficient management dashboard for orders, drivers, customers, and financial operations including POD approvals and withdrawal requests.",
    "Equip drivers with a mobile application for order management, navigation, proof of delivery capture, and earnings tracking.",
    "Ensure secure, role-based access across all user types with modern authentication.",
    "Integrate payment solutions tailored for the Kenya market such as M-Pesa STK Push.",
    "Offer analytics and reporting to optimize logistics operations and monitor performance."
  ],
  "key_features": [
    "User authentication for customers, admins, and drivers through Supabase Auth with JWT tokens and role-based authorization.",
    "Customer Panel that supports order creation with distance or per-box pricing, multi-drop functionality, order tracking using Google Maps API, and payment through M-Pesa, wallet, or invoice.",
    "Admin Panel with a three-panel layout including a header, collapsible sidebar navigation with hierarchical menus, and a main content area featuring data tables with selectable and expandable rows.",
    "Detailed management pages for orders, drivers/partners, and customers with master-detail views, tabbed interfaces, and action buttons such as add, edit, approve or reject.",
    "Driver mobile app developed in Flutter enabling authentication, order list viewing, step-by-step order progress tracking, map-based navigation, POD uploading with camera and signature, wallet and withdrawal management.",
    "Backend API endpoints implementing layered architecture patterns for authentication, order management, driver assignment, POD handling, and price calculation.",
    "Consistent date/time and currency formatting standardized to DD/MM/YYYY, HH:MM:SS and Ksh respectively.",
    "Data security with row-level security policies, middleware enforcing authentication and user role types, and audit logging."
  ],
  "user_flow_summary": [
    "Customers sign up or log in to the customer panel, create delivery orders specifying pick-up, multi-drop locations, and pricing preferences, make payments, and track order progress through interactive timelines and maps.",
    "Admins authenticate via dedicated login, access a three-panel dashboard with sidebar navigation and header, manage and filter orders, review and approve PODs, manage drivers and customers via searchable lists with expandable detail views and tabs, and handle financial processes including withdrawal approvals and price card management.",
    "Drivers log into the mobile app, receive assigned orders, view ongoing and completed orders with detailed progress steps, navigate to pickup/dropoff locations via integrated maps, upload PODs using camera and signatures, monitor wallet balance and earnings, review transaction history, and submit withdrawal requests.",
    "All roles operate via secure JWT token authentication and role-based access control, ensuring appropriate permissions and data privacy across platform components."
  ],
  "validation_criteria": [
    "Successful user authentication flows for customers, admins, and drivers including token verification and logout endpoints.",
    "Order creation and retrieval functions handle multi-drop orders, pricing calculations, and correct data persistence in Supabase database.",
    "Admin panel displays consistent three-panel layouts with functional sidebar navigation, search and filter capabilities, selectable and expandable data tables, and tabbed detail views as per design guidelines.",
    "Driver app supports secure login, order list management, map-based navigation accuracy, POD capture with camera and signature, wallet and withdrawal functionalities.",
    "Payment integrations including M-Pesa STK Push and wallet payments process correctly with transaction records reflected in the database.",
    "Role-based middleware effectively restricts access to endpoints and UI views according to user roles with enforcement of RLS policies.",
    "Date, time, and currency values are displayed consistently across all platform components.",
    "System health endpoint responds correctly indicating backend availability.",
    "Audit logs capture key actions and changes to enable traceability and compliance."
  ],
  "code_summary": {
    "project_name": "Logistics Platform",
    "description": "Complete logistics platform similar to Sendy (Kenya) with Customer Panel, Admin Panel, and Driver App",
    "tech_stack": {
      "backend": {
        "framework": "Express.js",
        "runtime": "Node.js",
        "database": "Supabase PostgreSQL",
        "authentication": "Supabase Auth",
        "storage": "Supabase Storage",
        "additional": [
          "Redis",
          "Mailgun",
          "Google Maps API",
          "M-Pesa STK Push"
        ]
      },
      "frontend": {
        "customer_panel": {
          "framework": "React.js",
          "build_tool": "Vite",
          "styling": "Tailwind CSS",
          "state_management": "React Context API",
          "routing": "React Router",
          "port": 3001
        },
        "admin_panel": {
          "framework": "React.js",
          "build_tool": "Vite",
          "styling": "Tailwind CSS",
          "state_management": "React Context API",
          "routing": "React Router",
          "port": 3002
        }
      },
      "mobile": {
        "framework": "Flutter",
        "language": "Dart",
        "state_management": "Riverpod",
        "architecture": "MVVM/Clean Architecture"
      }
    },
    "architecture": {
      "backend": {
        "structure": "Layered Architecture",
        "layers": [
          "controllers",
          "services",
          "repositories",
          "routes",
          "middleware",
          "utils"
        ],
        "port": 3000,
        "base_url": "http://localhost:3000/api"
      },
      "frontend": {
        "pattern": "Component-based",
        "structure": [
          "components",
          "contexts",
          "pages",
          "services",
          "utils"
        ]
      }
    },
    "features": {
      "customer_panel": [
        "User authentication (signup/login)",
        "Order creation with distance-based or per-box pricing",
        "Order tracking with timeline and map",
        "Order history with expandable rows",
        "Multi-drop support (retail: 4 max, corporate: unlimited)",
        "Payment integration (M-Pesa, wallet, invoice)",
        "Google Maps integration for location selection"
      ],
      "admin_panel": [
        "Admin authentication",
        "Order management dashboard",
        "Driver management",
        "Customer management",
        "POD (Proof of Delivery) review and approval",
        "Withdrawal request approval",
        "Price card management",
        "Analytics and reporting"
      ],
      "driver_app": [
        "Driver authentication via backend API",
        "Order list (ongoing and completed)",
        "Order detail with step-by-step progress",
        "Map integration for navigation",
        "POD upload with camera and signature",
        "Wallet and earnings view",
        "Transaction history",
        "Withdrawal requests",
        "Profile management"
      ],
      "backend_api": [
        "Authentication endpoints (driver login, token verification, logout)",
        "Order management (create, get by ID)",
        "Driver management (assign order)",
        "POD management (upload, approve/reject)",
        "Pricing engine (distance-based and per-box pricing)",
        "Health check endpoint"
      ]
    },
    "api_endpoints": {
      "auth": {
        "POST /api/auth/drivers/login": "Driver login",
        "GET /api/auth/verify": "Verify token",
        "POST /api/auth/logout": "Logout"
      },
      "orders": {
        "POST /api/orders/create": "Create new order",
        "GET /api/orders/:orderId": "Get order by ID"
      },
      "drivers": {
        "POST /api/drivers/:driverId/assign-order": "Assign order to driver"
      },
      "pods": {
        "POST /api/pods/upload": "Upload proof of delivery",
        "POST /api/pods/:podId/approve": "Approve/reject POD"
      },
      "health": {
        "GET /health": "Health check"
      }
    },
    "database": {
      "provider": "Supabase PostgreSQL",
      "tables": [
        "users",
        "companies",
        "orders",
        "order_items",
        "drops",
        "drivers",
        "vehicles",
        "pods",
        "price_cards",
        "wallets",
        "transactions",
        "withdrawal_requests",
        "notifications",
        "audit_logs"
      ],
      "authentication": {
        "provider": "Supabase Auth",
        "tables": [
          "auth.users"
        ],
        "sync_mechanism": "Database trigger (handle_new_user)"
      }
    },
    "security": {
      "authentication": "JWT tokens via Supabase",
      "authorization": "Role-based (admin, customer, driver)",
      "middleware": [
        "authenticate",
        "requireUserType"
      ],
      "row_level_security": "RLS policies on Supabase tables"
    },
    "environment_variables": {
      "backend": [
        "SUPABASE_URL",
        "SUPABASE_SERVICE_ROLE_KEY",
        "SUPABASE_ANON_KEY",
        "PORT",
        "FRONTEND_URL"
      ],
      "frontend": [
        "VITE_SUPABASE_URL",
        "VITE_SUPABASE_ANON_KEY"
      ],
      "mobile": [
        "API_BASE_URL"
      ]
    },
    "date_time_format": {
      "date": "DD/MM/YYYY",
      "time": "HH:MM:SS",
      "datetime": "DD/MM/YYYY HH:MM:SS"
    },
    "currency": "Ksh (Kenyan Shilling)"
  }
}
